#!/bin/bash

LANG=''

[[ ! $1 ]] && exit

act="$1"

[[ $2 = "-d" ]] && DEBUG='y'
function debug()
{
	if [[ $DEBUG = 'y' ]]; then
		echo "$@"
	fi
}

cmus-remote -Q &>/tmp/cmus_state
cmus_state="$(cat /tmp/cmus_state)"
awnser_len="$(echo $cmus_state | wc -w)"

# cmus is not runnig
if [[ $awnser_len -eq 5 ]]; then
	# check mocp stat
	debug "mocp"

	mocp -i -Q %state &>/tmp/mocp_state
	mocp_state="$(cat /tmp/mocp_state)"

	debug $mocp_state

	if [[ $(echo $mocp_state | grep FATAL) ]]; then
		mocp --server
		mocp --play
	else
		case $act in
			next)
				mocp --next
				;;
			prev)
				mocp --previous
				;;
			toggle)
				mocp --toggle-pause
		esac
	fi
else
	case $act in
		next)
			cmus-remote --next
			;;
		prev)
			cmus-remote --prev
			;;
		toggle)
			# toggle pause
			cmus-remote --pause
	esac
fi
