#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <errno.h>

#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>

int main(int argc, char **argv)
{
	int fd;
	char *buf;
	ssize_t sz = 0x0, overall = 0x0;

	printf(":: Stage 1 ::\n");
	printf("Creating test-files...\n");
	printf("  => 256 bytes...\n");

    fd = open("./256", O_WRONLY | O_CREAT);
	buf = (char*) malloc(256*(sizeof(char)));
	sz = write(fd, buf, 256);
	close(fd);
	free(buf);

	printf("  => 3 bytes...\n");
	buf = (char*) malloc(3 * sizeof(char));
	fd = open("3", O_WRONLY | O_CREAT);
	sz = write(fd, buf, 3);
	free(buf);
	close(fd);

	printf("  => 65 bytes...\n");
	buf = (char*) malloc(65*sizeof(char));
	fd = open("65", O_WRONLY | O_CREAT);
	sz = write(fd, buf, 65);
	free(buf);
	close(fd);

	buf = (char*)malloc(8);

	printf(":: Stage 2 ::");
	printf("Reading files within 64bit blocks...\n");
	printf("  => 256...\n");

	fd = open("256", O_RDONLY);
	perror("  `- open(): ");
	printf("  `- reading data...\n");
	overall = 0;
    while( (sz = read(fd, buf, 8)) == 8 )
	{
		overall += sz;
		printf("    `- read: %i bytes (total: %i)\r", sz, overall);
	}
	printf("\n");
	if( sz != -1 || sz != 0)
		printf("  `- last sz = %i\n", sz);

	close(fd);

    printf("  => 65\n");
	fd = open("65", O_RDONLY);
	perror("  `- open(): ");
	printf("  `- reading data...\n");
	overall = 0;
    while( (sz = read(fd, buf, 8)) == 8 )
	{
		overall += sz;
		printf("    `- read: %i bytes (total: %i)\r", sz, overall);
	}
	printf("\n");
	if( sz != -1 || sz != 0)
		printf("  `- last sz = %i\n", sz);


	free(buf);

	exit(EXIT_SUCCESS);
}
