#!/bin/bash

PID=$(ps aux | grep 'libflash' | grep -v grep | head -n2 | tail -n1 | awk '{print $2}')
movs=$(ls -l /proc/$PID/fd | grep Flash | awk '{print $9}')
num=$(echo $movs | wc -w)
let cur=1

num_length=$(echo $movs | wc -w | wc -c)
let num_length--


for mov in $movs;
do
    printf "(%0${num_length}i / %0${num_length}i) Working on /proc/%i/fd/%i..." $cur $num $PID $mov
    cp /proc/$PID/fd/$mov ./flash_no_$mov.flv &
    cur_pid=$!
    while [[ $( ps -eo pid | grep $cur_pid ) ]]; do
        for i in \\ \| / -; do
            printf ' %c\b\b' $i
            sleep 0.25
        done
    done
    echo " [DONE]";
    let cur++;
done
