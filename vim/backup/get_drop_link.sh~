#!/bin/bash 

# На всякий случай
dropbox start &>/dev/null

if [[ -z $1 ]]; then
    if [[ $(command -v zenity) ]]; then
        f=$(zenity --file-selection)
    else
        echo 'У вас не установлена программа zenity'
        exit 1
    fi
else
  f=$1
fi

f=$(readlink -f "$1")
url=$(dropbox puburl "$f")

if [[ -z $(echo $url | grep http) ]]; then
  echo $url
  exit 1
else
  msg="<b>Ваша ссылка:</b> <i>$url</i>"
  if [[ $(command -v xsel) ]]; then
    echo $url | xsel -i -b -p -s;
    msg=$msg"\n<b>Скопирована в буфер обмена</b>"
  fi
  echo $msg
  if [[ $(command -v notify-send) ]]; then
    notify-send -t 5000 'Ссылка скопирована в буфер обмена.'
  fi
fi
